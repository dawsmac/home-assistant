- id: '1300'
  alias: morning mode
  trigger:

    - platform: time
      at:
        - sensor.sm_faye_next_alarm
        - sensor.sm_g991b_next_alarm
      id: 'morningalarm'
  
    - platform: template
      value_template: "{{ is_state('sun.sun', 'above_horizon') }}"
      id: 'morningaway'
      
    - platform: state
      id: 'morning mode triggered by no-wireless charging'
      entity_id:
        - sensor.sm_faye_charger_type
        - sensor.sm_faye_charger_type
      from: 'wireless'
      to: 'none'

  action:
    - choose:
        - conditions:
            - condition: trigger
              id: 'morningalarm'
            - condition: time
              after: '05:00'
              before: '09:00'
            - condition: state
              entity_id: input_boolean.night_mode
              state: 'on'
            - condition: state
              entity_id: group.persons
              state: 'home'
          sequence:
            - service: input_boolean.turn_off
              target:
                entity_id: input_boolean.night_mode

        - conditions:
            - condition: trigger
              id: 'morning mode triggered by no-wireless charging'
            - condition: time
              after: '05:00'
              before: '10:00'
            - condition: state
              entity_id: input_boolean.night_mode
              state: 'on'
            - condition: state
              entity_id: group.persons
              state: 'home'
          sequence:
            - service: input_boolean.turn_off
              target:
                entity_id: input_boolean.night_mode

        - conditions:
            - condition: trigger
              id: 'morningaway'
            - condition: state
              entity_id: group.persons
              state: 'not_home'
            - condition: state
              entity_id: input_boolean.night_mode
              state: 'on'
          sequence:
            - service: input_boolean.turn_off
              target:
                entity_id: input_boolean.night_mode


- id: '1301'
  alias: Morning lights
  trigger:
    - platform: state
      id: "morninglight"
      entity_id: input_boolean.night_mode
      to: "off"
    - platform: state
      id: "morningnolights"
      entity_id: binary_sensor.enable_auto_lights
      to: "off"
      for:
        minutes: 5
  action:
    - choose:
        - conditions:
            - condition: trigger
              id: "morninglight"
            - condition: template
              value_template: "{{ state_attr('sun.sun','rising') == true }}"
            - condition: state
              entity_id: binary_sensor.enable_auto_lights
              state: "on"
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.morning_lights
        - conditions:
            - condition: trigger
              id: "morningnolights"
            - condition: template
              value_template: "{{ state_attr('sun.sun','rising') == true }}"
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.morning_nolights


- id: '1303'
  alias: Morning time Kitchen
  trigger:
    - platform: time
      at:
        - sensor.sm_faye_next_alarm
        - sensor.sm_g991b_next_alarm
  condition:
    - condition: template
      value_template: "{{ state_attr('sun.sun','rising') == true }}"
  action:
    - wait_for_trigger:
      - platform: state
        entity_id: binary_sensor.hallway_pir
        from: "off"
        to: "on"
      timeout: "02:00:00"
      continue_on_timeout: false
    - service: media_player.play_media
      target:
        entity_id: media_player.kitchen
      data:
        media_content_id: FV:2/7
        media_content_type: favorite_item_id
        volume_level: 0.22
      metadata:
        title: Virgin Radio UK
        thumbnail: >-
          https://d1uner0r1fcap8.cloudfront.net/image?w=60&image=https%3A%2F%2Fcdn-profiles.tunein.com%2Fs266113%2Fimages%2Flogog.png%3Ft%3D1&partnerId=tunein
        media_class: genre
        children_media_class: null
        navigateIds:
          - {}
          - media_content_type: favorites
            media_content_id: ''
          - media_content_type: favorites_folder
            media_content_id: object.item.audioItem.audioBroadcast
      
    - service: scene.turn_on
      target:
        entity_id: scene.appliances_on