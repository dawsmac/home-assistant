- id: '900'
  alias: Heating On
  trigger:
    - platform: template
      value_template: >
        {{ is_state('switch.downstairs_radiators', 'on') or
          is_state('switch.upstairs_radiators', 'on') or
          is_state('switch.underfloor_heating', 'on') }}
  condition:
    condition: not
    conditions:
      - condition: state
        entity_id: switch.boiler_call
        state: 'on'
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.boiler_call


- id: '901'
  alias: Hotwater on
  trigger:
    - platform: state
      entity_id: switch.hotwater
      to: 'on'
  condition:
    - condition: state
      entity_id: switch.boiler_call
      state: 'off'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Awake'
    - condition: state
      entity_id: group.persons
      state: 'home'
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.boiler_call

- id: '902'
  alias: Heating Off
  trigger:
    - platform: template
      value_template: >
        {{ is_state('switch.downstairs_radiators', 'off') and
          is_state('switch.underfloor_heating', 'off') and
          is_state('switch.upstairs_radiators', 'off') and
          is_state('switch.hotwater', 'off') }}
  condition:
    condition: not
    conditions:
      - condition: state
        entity_id: switch.boiler_call
        state: 'off'
  action:
    - service: switch.turn_off
      target:
        entity_id: switch.boiler_call 
  
- id: '903'
  alias: HA restart hotwater
  trigger:
    - platform: homeassistant
      event: start
    - platform: state
      entity_id: input_select.house_mode
      to: "Awake"
  condition: 
    - condition: state
      entity_id: switch.hotwater
      state:   "on"
    - condition: state
      entity_id: switch.boiler_call
      state: "off"
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.boiler_call

- id: '904'
  alias: No ones home turn off Heating
  trigger:
    - platform: state
      entity_id: group.persons
      to: 'not_home'
      for: "00:05:00"
  action:
    - service: climate.set_preset_mode
      target:
        entity_id: 
          - climate.upstairs
          - climate.downstairs
          - climate.office
      data:
        preset_mode: away

- id: '905'
  alias: home Turn on Heating
  trigger:
    - platform: state
      entity_id: group.persons
      to: 'home'
    - platform: homeassistant
      event: start
  condition:
    - condition: or
      conditions: 
        - condition: state
          entity_id: 'person.richard'
          state: 'home' 
        - condition: state
          entity_id: 'person.faye'
          state: 'home' 
  action:
    - service: climate.set_preset_mode 
      target:
        entity_id:
          - climate.upstairs
          - climate.downstairs
          - climate.office
      data:
        preset_mode: none

  
- id: '906'  
  alias: Morning heating
  trigger:
    - platform: state
      entity_id: binary_sensor.morning_alarm
      to: 'on'
  condition:
    - condition: time
      after: '05:00'
      before: '09:00'
    - condition: state
      entity_id: group.persons
      state: 'home'
  action:
    - service: climate.set_temperature 
      target:
        entity_id: 
          - climate.upstairs
          - climate.downstairs
          - climate.office
      data:
        temperature: 20
  
- id: '907'
  alias: forecast for heating
  trigger:
    - platform: template
      id: "cold"
      value_template: >
        {{ state_attr('weather.edenbridge', 'forecast')[2]['templow'] <= 5}}
    - platform: template
      id: "warm"
      value_template: >
        {{ state_attr('weather.edenbridge', 'forecast')[0]['templow'] > 5}}
  action:
    - condition: trigger
      id: cold
    - service: climate.set_hvac_mode
      target:
        entity_id: 
          - climate.upstairs
          - climate.downstairs
          - climate.office
          - climate.kitchen
      data:
        hvac_mode: heat
    - condition: trigger
      id: warm
    - service: climate.set_hvac_mode
      target:
        entity_id: 
          - climate.upstairs
          - climate.downstairs
          - climate.office
          - climate.kitchen
      data:
        hvac_mode: off